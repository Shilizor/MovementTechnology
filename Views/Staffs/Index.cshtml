@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@using Microsoft.AspNetCore.Identity
@using MovementTechnology.Data
@model IEnumerable<MovementTechnology.Data.Staff>
@{
var user = await UserManager.GetUserAsync(User);
}

@{
    ViewData["Title"] = "Staffs Page";
    ViewData["nav_item_staff"] = "nav_item active";
}

<div class="bg">
    <div class="mainmenu">
        <div class="search">
            <img src="/img/searchicon.png" alt="" class="search_img">
            <input type="text" class="search_inp" placeholder="Поиск данных">
        </div>
        @if (SignInManager.IsSignedIn(User))
        {
            @if (user.privilege >= 1)
            {
                <a class="addbtn" onclick="showInPopup('@Url.Action("AddOrEditStaff", "Staffs", null, Context.Request.Scheme)')">
                    <img src="/img/addicon.png" alt="" class="addbtn_img">
                    <p class="addbtn_text">Добавить</p>
                </a>
            }
        }
    </div>
    <div class="maincontentbg">
        <div class="maincontent">
            <table class="table">
                <colgroup>
                    <col style="width: 10%;">
                    <col style="width: 12%;">
                    <col style="width: 12%;">
                    <col style="width: 12%;">
                    <col style="width: 12%;">
                    <col style="width: 12%;">
                    <col style="width: 12%;">
                    @if (SignInManager.IsSignedIn(User))
                    {
                        @if (user.privilege >= 1)
                        {
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                        }
                    }
                </colgroup>
                <thead>
                <tr>
                    <th class="is_sort" sort="id">Идентификатор</th>
                    <th class="is_sort" sort="staff_lastname">Фамилия</th>
                    <th class="is_sort" sort="staff_firstname">Имя</th>
                    <th class="is_sort" sort="staff_middlename">Отчество</th>
                    <th class="is_sort" sort="staff_dep_id">Отдел</th>
                    <th class="is_sort" sort="staff_cabinetnumber">Номер кабинета</th>
                    @if (SignInManager.IsSignedIn(User))
                    {
                        @if (user.privilege >= 1)
                        {
                            <th colspan="3">Действия</th>
                        }
                    }
                </tr>
                </thead>
                <tbody id="depToUpdate">
                @await Html.PartialAsync("StaffsData", Model)
                </tbody>
            </table>
        </div>
    </div>

    <div class="modal-container">
        <div class="modal-window">
            <div class="modal-close">&times;</div>
            <div id="depToUpdate1"></div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        function AllStaffs()
        {
            $.ajax({
                type: "POST",
                url: "@Url.Action("StaffsData", "Staffs")",
                success: function (result) {
                    $("#depToUpdate").html(result);
                }
            });
        }
    </script>
}